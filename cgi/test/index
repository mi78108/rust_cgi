#!/usr/bin/env ruby

require_relative '../_init_'
html_page = './page.html'

Q.map :GET do |_, resp|
  aaa = 123
  if File.readable?(html_page)
    @bbb = 789
    resp.body(File.read(html_page)).html.render do |v|
      v.title = 'Test Page'
    end.finally
  else
    resp.fail_404 ENV.to_a.to_json
  end
end

Q.map :WEBSOCKET do |_|
  Q.recv do |val|
    Q.write "#{val}_#{Time.now}"
  end
end

Q.map do |_, r|
  r.fail_404 ENV.to_a.to_json
end
